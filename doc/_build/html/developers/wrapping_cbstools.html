

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Wrapping an existing CBS Tools class &mdash; Nighres 1.1.0b1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/adapt_sphinx_rtd.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Adding a new Python function" href="python_function.html" />
    <link rel="prev" title="Setting up" href="setup.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/nighres_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installing Nighres</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auto_examples/index.html">Nighres usage examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules and Functions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../brain/index.html">Brain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cortex/index.html">Cortex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/index.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filtering/index.html">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intensity/index.html">Intensity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../laminar/index.html">Laminar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../microscopy/index.html">Microscopy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../registration/index.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shape/index.html">Shape</a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/index.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../surface/index.html">Surface</a></li>
</ul>
<p class="caption"><span class="caption-text">Good to know</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_formats.html">Data handling and formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../saving.html">Saving outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../levelsets.html">Levelsets</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setting up</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Wrapping an existing CBS Tools class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#standard-procedures">Standard procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-wrapper-content">General wrapper content</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convenience-python-layer">Convenience python layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-if-my-favorite-cbs-tools-module-is-not-ready-to-wrap">What if my favorite CBS Tools module is not ready to wrap?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python_function.html">Adding a new Python function</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Writing examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Adapting the docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="pr.html">Making a Pull Request</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nighres</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Wrapping an existing CBS Tools class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developers/wrapping_cbstools.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="wrapping-an-existing-cbs-tools-class">
<span id="wrap-cbstools"></span><h1>Wrapping an existing CBS Tools class<a class="headerlink" href="#wrapping-an-existing-cbs-tools-class" title="Permalink to this headline">¶</a></h1>
<p>You want to wrap an existing CBS Tools module into Nighres? Great!</p>
<div class="section" id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>The CBS Tools modules have been first created for JIST. Most of them are
however not directly dependent on the JIST and MIPAV libraries, which is why
we can turn them into a JCC-compatible, lightweight library.</p>
<p>JCC requires that all data is passed as numbers, strings, and 1D arrays, so this
is what the CBS Tools modules need to manipulate as input and output, and also
why we created a second python layer for structured data handling. Once a
CBS Tools module has been formatted to the adequate i/o structure, JCC wraps
it and you can call it directly from python.</p>
</div>
<div class="section" id="standard-procedures">
<h2>Standard procedures<a class="headerlink" href="#standard-procedures" title="Permalink to this headline">¶</a></h2>
<p>Each JCC-wrapped CBS Tools module has three important functions: .setSomeParameter(),
.getSomeResult(), and .execute(). You need to set the inputs with meaningful values,
execute the module, and retrieve the results. Note that default parameters are
always assumed when possible, but a good wrapper should expose all parameters.</p>
</div>
<div class="section" id="general-wrapper-content">
<h2>General wrapper content<a class="headerlink" href="#general-wrapper-content" title="Permalink to this headline">¶</a></h2>
<p><strong>1 Start the Java Virtual Machine (JVM)</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">cbstools.initVM(initialheap='6000m',</span> <span class="pre">maxheap='6000m')</span></code></p>
<p>Note that the initial and maximum amount of allocated memory may be
adjusted or set up as a global parameter.</p>
</div></blockquote>
<p><strong>2 Create an instance of the module</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">mymodule</span> <span class="pre">=</span> <span class="pre">cbstools.SomeCoolModule()</span></code></div></blockquote>
<p><strong>3 Set all the parameters and data arrays</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">my_module.setThisImportantParameter(some_value)</span></code>
<code class="docutils literal notranslate"><span class="pre">my_module.setInputImage(cbstools.JArray('float')((my_image_data.flatten('F')).astype(float))</span></code></div></blockquote>
<p><strong>4 Run the module</strong></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">my_module.execute()</span></code></div></blockquote>
<p><strong>5 Retrieve the outputs</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">my_result_data</span> <span class="pre">=</span> <span class="pre">np.reshape(np.array(my_module.getCoolResultImage(),</span> <span class="pre">dtype=np.float32),</span> <span class="pre">dimensions,</span> <span class="pre">'F')</span></code></p>
<p>Note that because you are passing simple 1D arrays, you need to keep a record
of image dimensions, resolutions, headers, etc.</p>
</div></blockquote>
</div>
<div class="section" id="convenience-python-layer">
<h2>Convenience python layer<a class="headerlink" href="#convenience-python-layer" title="Permalink to this headline">¶</a></h2>
<p>We strongly advise (at least for inclusion into Nighres) to handle the inputs
and outputs of python structures as we do, i.e. loading images from files or
passing them as Nifti1Image, and allowing to save all outputs automatically.</p>
<p>We also adhere to a somewhat strict formatting of the outputs with two suffixes,
first for the module name, and second for the specific output, e.g. ‘’_mgdm_seg’’
for the segmentation obtained from the mgdm_brain_segmentation module.</p>
</div>
<div class="section" id="what-if-my-favorite-cbs-tools-module-is-not-ready-to-wrap">
<h2>What if my favorite CBS Tools module is not ready to wrap?<a class="headerlink" href="#what-if-my-favorite-cbs-tools-module-is-not-ready-to-wrap" title="Permalink to this headline">¶</a></h2>
<p>Because preparing modules for wrapping requires some reformatting, only a few
modules so far are ready. You can accelerate the process in two ways: 1) send
a request to <a class="reference external" href="https://www.github.com/piloubazin/">the CBS Tools developers</a>
or 2) write a reformatted module for CBS Tools yourself and make a pull request.
All the currently wrapped CBS Tools modules follow the same formatting procedure,
so transforming a JIST module definition into a core module (which then can be
called either from JIST or from Nighres) should be reasonably easy in most cases.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="python_function.html" class="btn btn-neutral float-right" title="Adding a new Python function" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="setup.html" class="btn btn-neutral float-left" title="Setting up" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The Nighres authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>